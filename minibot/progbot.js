/*! progbot v1.0.0 (c) sarkiroka */
(function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(r,'a',r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=18)})([function(e){var t=function(e,r){t.canvas=e,t.ctx=r};t.canvas=null,t.ctx=null,t.center={},t.centerX=0,t.centerY=0,t.setSize=function(e,r){t.width=e,t.height=r,t.canvas.width=e,t.canvas.height=r,t.centerX=e/2,t.centerY=r/2,t.center={x:t.centerX,y:t.centerY}},e.exports=t},function(e,t,r){(function(o){function n(){var e;try{e=t.storage.debug}catch(t){}return!e&&'undefined'!=typeof o&&'env'in o&&(e=o.env.DEBUG),e}t=e.exports=r(22),t.log=function(){return'object'==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?'%c':'')+this.namespace+(r?' %c':' ')+e[0]+(r?'%c ':' ')+'+'+t.humanize(this.diff),!!r){var o='color: '+this.color;e.splice(1,0,o,'color: inherit');var n=0,a=0;e[0].replace(/%[a-zA-Z%]/g,function(e){'%%'===e||(n++,'%c'===e&&(a=n))}),e.splice(a,0,o)}},t.save=function(e){try{null==e?t.storage.removeItem('debug'):t.storage.debug=e}catch(t){}},t.load=n,t.useColors=function(){return'undefined'!=typeof window&&window.process&&'renderer'===window.process.type||('undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:'undefined'!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||'undefined'!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||'undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||'undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage='undefined'!=typeof chrome&&'undefined'!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),t.colors=['#0000CC','#0000FF','#0033CC','#0033FF','#0066CC','#0066FF','#0099CC','#0099FF','#00CC00','#00CC33','#00CC66','#00CC99','#00CCCC','#00CCFF','#3300CC','#3300FF','#3333CC','#3333FF','#3366CC','#3366FF','#3399CC','#3399FF','#33CC00','#33CC33','#33CC66','#33CC99','#33CCCC','#33CCFF','#6600CC','#6600FF','#6633CC','#6633FF','#66CC00','#66CC33','#9900CC','#9900FF','#9933CC','#9933FF','#99CC00','#99CC33','#CC0000','#CC0033','#CC0066','#CC0099','#CC00CC','#CC00FF','#CC3300','#CC3333','#CC3366','#CC3399','#CC33CC','#CC33FF','#CC6600','#CC6633','#CC9900','#CC9933','#CCCC00','#CCCC33','#FF0000','#FF0033','#FF0066','#FF0099','#FF00CC','#FF00FF','#FF3300','#FF3333','#FF3366','#FF3399','#FF33CC','#FF33FF','#FF6600','#FF6633','#FF9900','#FF9933','#FFCC00','#FFCC33'],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return'[UnexpectedJSONParseError]: '+e.message}},t.enable(n())}).call(t,r(21))},function(e,t,r){var o=r(26),n=r(28),a={IDLE:'IDLE',CHECK_ANIMATION:'CHECK_ANIMATION',RESULT_ANIMATION:'RESULT_ANIMATION',END:'END'},i=[],d=0,s=a.IDLE;e.exports=function(e){if('undefined'!=typeof e&&1<=arguments.length){var t='string'==typeof a[e];t?s=a[e]:console.warn(e,'is not a valid state')}return s},e.exports.IDLE=a.IDLE,e.exports.CHECK_ANIMATION=a.CHECK_ANIMATION,e.exports.RESULT_ANIMATION=a.RESULT_ANIMATION,e.exports.END=a.END,e.exports.addProgramStep=function(e){return s==a.IDLE?(i.push(e),1):(console.warn('the operation is not permitted by current game state'),-1)},e.exports.removeLastProgramStep=function(){return s==a.IDLE?0==i.length?(console.warn('there are no more proram step'),0):(i.pop(),1):(console.warn('the operation is not permitted by current game state'),-1)},e.exports.getProgram=function(){return i};var l=null;e.exports.getBoard=function(){return l},e.exports.levelUp=function(){d++},e.exports.loadBoard=function(e){o(d,function(t,r){t?console.error('error in board request',t):l=r.board,i=[],r.demo?n(r.demo,e):e()})},e.exports.getLevel=function(){return d}},function(e){e.exports={backgroundColor:'#777',programStepBackground:'#999',programStepHighlightBackground:'#ddd',arrowGradientStartColor:'#000',arrowGradientEndColor:'#888',arrowHighlightGradiendStartColor:'#800',arrowHighlightGradiendEndColor:'#d00',waitGradientStartColor:'#080000',waitGradientEndColor:'#928888',waitHighlightGradiendStartColor:'#800',waitHighlightGradiendEndColor:'#d22',waitTextColor:'#aaa',waitTextHighlightColor:'#eee',programStepSize:50,programStepMargin:3,boardItemSize:50,boardItemMargin:3,dummy:null}},function(e,t,r){var o=r(10),n=r(1)('progbot:draw:redraw'),a=r(11),i=r(13),d=r(2);e.exports=function(e){n('now redraw'),o(),i(d.getProgram()),a(d.getBoard(),e)}},function(e){e.exports={beforeResultTimeSeconds:1,resultTimeSeconds:4,robotStepTimeSeconds:1.25,waitForNextStepSeconds:1.25}},function(e,t,r){var o=Math.round,n=Math.floor,a=r(0),i=r(3),d=r(12),s=r(2);e.exports=function(e,t){var r=s.getBoard(),o=d(r),l=a.centerX-n(o.x/2)*i.boardItemSize-i.boardItemSize/2,p=a.centerY-n(o.y/2)*i.boardItemSize-i.boardItemSize/2,c=i.boardItemSize-i.boardItemMargin,g=0.5*c;return{x:l+e*i.boardItemSize+g,y:p+t*i.boardItemSize+g}},e.exports.reverse=function(e,t){var r=s.getBoard(),l=d(r),p=a.centerX-n(l.x/2)*i.boardItemSize-i.boardItemSize/2,c=a.centerY-n(l.y/2)*i.boardItemSize-i.boardItemSize/2,g=i.boardItemSize-i.boardItemMargin,m=0.5*g;return{x:o((e-p-m)/i.boardItemSize),y:o((t-c-m)/i.boardItemSize)}}},function(e){var t={};t.S=2,t.E=4,t.X=1,t.C=6,t['\u27F2']=8,t['\u27F3']=24,t['\u21A4']=40,t['\u21A6']=56,t['\u21A5']=72,t['\u21A7']=88,t['\u2194']=104,t['\u2195']=120,t['#']=0,e.exports=t},function(e,t,r){var o=r(0),n=r(3),a=document.getElementById('robot');e.exports=function(e,t){'number'!=typeof t&&(t=1);var r=o.ctx,i=n.boardItemSize-n.boardItemMargin,d=0.05*i*t,s=0.9*i*t,l=0.5*i*t;r.save(),r.translate(e.x,e.y),r.rotate(e.direction*Math.PI/180),r.drawImage(a,-l+d,-l+d,s,s),r.restore()}},function(e,t,r){function o(e,t,r,o){i=n.ctx.getImageData(e,t,r,o),d={x:e,y:t},s={w:r,h:o}}var n=r(0),a=r(1)('progbot:draw:board:save'),i=null,d=null,s=null;e.exports=function(e){(s||i||d)&&console.warn('overwrite a saved image data'),o(e.x,e.y,e.w,e.h)},e.exports.clear=function(){s=null,i=null,d=null},e.exports.restore=function(){n.ctx.putImageData(i,d.x,d.y)},e.exports.update=function(){o(d.x,d.y,s.w,s.h)}},function(e,t,r){var o=r(0),n=r(3),a=r(1)('progbot:draw:clear'),i=r(2);e.exports=function(){a('clear all pixels');var e=o.ctx;e.setTransform(1,0,0,1,0,0),e.save(),e.fillStyle=n.backgroundColor,e.fillRect(0,0,o.canvas.width,o.canvas.height),e.textAlign='right',e.textBaseline='top',e.fillStyle='#fff',e.fillText('#'+i.getLevel(),o.width-5,5),e.restore()}},function(e,t,r){var o=Math.floor,n=r(0),a=r(3),d=r(1)('progbot:draw:board'),s=r(31),l=r(12);e.exports=function(e,t){var r=l(e),p=n.centerX-o(r.x/2)*a.boardItemSize-a.boardItemSize/2,c=n.centerY-o(r.y/2)*a.boardItemSize-a.boardItemSize/2;if(d('draw the board'),n.ctx.fillStyle='#eee',n.ctx.strokeStyle='#000',e)for(var g=0;g<e.length;g++)s(e[g],t);var i={x:p,y:c,w:2*(n.centerX-p),h:2*(n.centerY-c)};return i}},function(e,t,r){var o=r(1)('progbot:draw:board:get-size'),n={x:0,y:0};e.exports=function(e){if(!e||!e.length)o('zero length board found',e),d=n;else{var t=Infinity,r=Infinity,a=-Infinity,i=-Infinity;e.forEach(function(e){e.x<t&&(t=e.x),e.x>a&&(a=e.x),e.y<r&&(r=e.y),e.y>i&&(i=e.y)});var d={x:a-t,y:i-r};o('found a board with size',d)}return d}},function(e,t,r){var o=r(0),n=r(3),a=r(1)('progbot:draw:program-steps'),i=r(36);e.exports=function(e,t){var r=Math.max(1,Math.floor(o.width/n.programStepSize)),d=Math.ceil(e.length/r);a('now draw %d rows and %d cols',d,r);var s=0;o.ctx.lineWidth=1,o.ctx.strokeStyle='#000';for(var l=d-1;-1<l;l--)for(var p=0;p<r&&!(s>e.length-1);p++)i(l,p,e[s],t==s),s++}},function(e,t,r){var o=r(39);e.exports=function(){document.addEventListener('keydown',o)},e.exports.done=function(){document.removeEventListener('keydown',o)}},function(e,t,r){function o(){(!x||u)&&(clearTimeout(m),n())}function n(){c(c.IDLE),l()}var a=r(44),i=r(52),d=r(53),s=r(5),l=r(4),p=r(9),c=r(2),g=r(16),m=-1,x=null,u=!1;e.exports=function(){c()==c.RESULT_ANIMATION?o():c()==c.IDLE?(c(c.CHECK_ANIMATION),u=!1,a(function(e,t){e&&console.error(e),x=i(t),setTimeout(function(){c(c.RESULT_ANIMATION),p.clear(),a.reset(),d(x),x?(c.levelUp(),c.loadBoard(function(){u=!0,m=setTimeout(n,1e3*s.resultTimeSeconds)})):m=setTimeout(n,1e3*s.resultTimeSeconds)},s.beforeResultTimeSeconds*(x?1:1e3))})):c()==c.CHECK_ANIMATION?g():console.warn('don\'t touch the keyboard while animating!!',c())},e.exports.cancelResult=o},function(e,t,r){var o=r(5),n=!1,a=9,i=o.robotStepTimeSeconds,d=o.waitForNextStepSeconds,s=o.resultTimeSeconds,l=o.robotStepTimeSeconds/a,p=o.waitForNextStepSeconds/a,c=o.resultTimeSeconds/a;e.exports=function(){n=!n,n?(o.resultTimeSeconds=c,o.robotStepTimeSeconds=l,o.waitForNextStepSeconds=p):(o.resultTimeSeconds=s,o.robotStepTimeSeconds=i,o.waitForNextStepSeconds=d)}},function(e,t,r){var o=r(2);e.exports=function(e){o.addProgramStep(e)}},function(e,t,r){var o=r(19),n=r(57);o(),n()},function(e,t,r){r(20);var o=r(24),n=r(25),a=r(29),i=r(14);e.exports=function(){n(function(){o(),a(),i()})}},function(e,t,r){var o=r(1);o.enable('progbot:*,'+['draw:arrow','draw:wait','draw:draw-step','draw:program-steps','draw:board:get-size','event:on:end-of-programming:animate-step','draw:board','draw:clear','draw:redraw','event:resize','game:board:get-board','init:debug','draw:util:extend-board','event:on:end-of-programming:animate-program','event:end-of-game'].map(function(e){return'-progbot:'+e}).join());var n=o('progbot:init:debug');n('\t\t\t--==[ start ]==--\t\t\t')},function(e){function t(){throw new Error('setTimeout has not been defined')}function r(){throw new Error('clearTimeout has not been defined')}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===t||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function n(e){if(p===clearTimeout)return clearTimeout(e);if((p===r||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function a(){x&&g&&(x=!1,g.length?m=g.concat(m):u=-1,m.length&&d())}function d(){if(!x){var e=o(a);x=!0;for(var t=m.length;t;){for(g=m,m=[];++u<t;)g&&g[u].run();u=-1,t=m.length}g=null,x=!1,n(e)}}function s(e,t){this.fun=e,this.array=t}function i(){}var l,p,c=e.exports={};(function(){try{l='function'==typeof setTimeout?setTimeout:t}catch(r){l=t}try{p='function'==typeof clearTimeout?clearTimeout:r}catch(t){p=r}})();var g,m=[],x=!1,u=-1;c.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new s(e,t)),1!==m.length||x||o(d)},s.prototype.run=function(){this.fun.apply(null,this.array)},c.title='browser',c.browser=!0,c.env={},c.argv=[],c.version='',c.versions={},c.on=i,c.addListener=i,c.once=i,c.off=i,c.removeListener=i,c.removeAllListeners=i,c.emit=i,c.prependListener=i,c.prependOnceListener=i,c.listeners=function(){return[]},c.binding=function(){throw new Error('process.binding is not supported')},c.cwd=function(){return'/'},c.chdir=function(){throw new Error('process.chdir is not supported')},c.umask=function(){return 0}},function(e,t,r){function o(e){var r,o=0;for(r in e)o=(o<<5)-o+e.charCodeAt(r),o|=0;return t.colors[Math.abs(o)%t.colors.length]}function n(e){function r(){if(r.enabled){var e=r,o=+new Date,a=o-(n||o);e.diff=a,e.prev=n,e.curr=o,n=o;for(var d=Array(arguments.length),s=0;s<d.length;s++)d[s]=arguments[s];d[0]=t.coerce(d[0]),'string'!=typeof d[0]&&d.unshift('%O');var i=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(r,o){if('%%'===r)return r;i++;var n=t.formatters[o];if('function'==typeof n){var a=d[i];r=n.call(e,a),d.splice(i,1),i--}return r}),t.formatArgs.call(e,d);var l=r.log||t.log||console.log.bind(console);l.apply(e,d)}}var n;return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=o(e),r.destroy=a,'function'==typeof t.init&&t.init(r),t.instances.push(r),r}function a(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}t=e.exports=n.debug=n['default']=n,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable('')},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var r,o=('string'==typeof e?e:'').split(/[\s,]+/),n=o.length;for(r=0;r<n;r++)o[r]&&(e=o[r].replace(/\*/g,'.*?'),'-'===e[0]?t.skips.push(new RegExp('^'+e.substr(1)+'$')):t.names.push(new RegExp('^'+e+'$')));for(r=0;r<t.instances.length;r++){var a=t.instances[r];a.enabled=t.enabled(a.namespace)}},t.enabled=function(e){if('*'===e[e.length-1])return!0;var r,o;for(r=0,o=t.skips.length;r<o;r++)if(t.skips[r].test(e))return!1;for(r=0,o=t.names.length;r<o;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(23),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e){function t(e){if(e+='',!(100<e.length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),o=(t[2]||'ms').toLowerCase();return'years'===o||'year'===o||'yrs'===o||'yr'===o||'y'===o?r*d:'days'===o||'day'===o||'d'===o?r*p:'hours'===o||'hour'===o||'hrs'===o||'hr'===o||'h'===o?r*l:'minutes'===o||'minute'===o||'mins'===o||'min'===o||'m'===o?r*s:'seconds'===o||'second'===o||'secs'===o||'sec'===o||'s'===o?r*i:'milliseconds'===o||'millisecond'===o||'msecs'===o||'msec'===o||'ms'===o?r:void 0}}}function r(e){return e>=p?a(e/p)+'d':e>=l?a(e/l)+'h':e>=s?a(e/s)+'m':e>=i?a(e/i)+'s':e+'ms'}function o(e){return n(e,p,'day')||n(e,l,'hour')||n(e,s,'minute')||n(e,i,'second')||e+' ms'}function n(e,t,r){return e<t?void 0:e<1.5*t?Math.floor(e/t)+' '+r:Math.ceil(e/t)+' '+r+'s'}var a=Math.round,i=1e3,s=60*i,l=60*s,p=24*l,d=365.25*p;e.exports=function(e,n){n=n||{};var a=typeof e;if('string'==a&&0<e.length)return t(e);if('number'==a&&!1===isNaN(e))return n.long?o(e):r(e);throw new Error('val is not a non-empty string or a valid number. val='+JSON.stringify(e))}},function(e,t,r){var o=r(0);e.exports=function(){var e=document.getElementById('c'),t=e.getContext('2d');o(e,t)}},function(e,t,r){var o=r(2);e.exports=function(e){o.loadBoard(e)}},function(e,t,r){var o=r(1)('progbot:game:board:get-board'),n=r(27);e.exports=function(e,t){var r=n(e,4,'0')+'.json';o('try to get the "%s" board',r);var a=new XMLHttpRequest;a.open('GET',r),a.onload=function(){var e=[],r=null;if(200==a.status)try{var o=JSON.parse(a.responseText);e=o}catch(t){r='json parse error in ajax request'}else r='ajax request failed. status code: '+a.status;t(r,e)},a.send()}},function(e){e.exports=function(e,t,r){var o=e+'',n=r+'',a=!!n.length,i=o.length<t;for(a||console.warn('pad inpossible because no pad character defined',arguments);i&&a;)o=n+o,i=o.length<t;return o}},function(e){var t=document.getElementById('demo-container'),r=33;e.exports=function(e,o){var n=document.createElement('img'),a=(Math.random()+'').replace('.',''),i='demo-image-'+a;n.setAttribute('id',i),n.onload=function(){function n(){t.classList.add('hide'),t.removeChild(e),t.removeChild(d),clearInterval(a),clearTimeout(l),o()}t.classList.remove('hide');var e=document.getElementById(i);e.setAttribute('style','margin-left:-'+e.width/2+'px;margin-top:-'+e.height/2+'px;'),d.setAttribute('style','margin-top:-'+Math.min(e.height/2+32,window.innerHeight/2-5)+'px;');var a=setInterval(function(){s--,d.innerHTML=s+''},999),l=setTimeout(function(){n()},1e3*r);document.addEventListener('keydown',function t(r){r.preventDefault(),document.removeEventListener('keydown',t),n()})},n.onerror=function(){o()},n.setAttribute('src',e),t.appendChild(n);var d=document.createElement('div');d.setAttribute('id','demo-timer-'+a);var s=r;d.innerHTML=s,t.appendChild(d)}},function(e,t,r){var o=r(30);e.exports=function(){window.addEventListener('resize',o),o()},e.exports.done=function(){window.removeEventListener('resize',o)}},function(e,t,r){var o=r(0),n=r(1)('progbot:event:resize'),a=r(4);e.exports=function(t){n(t?'resize event handling':'initial resize event'),o.setSize(window.innerWidth,window.innerHeight),a()}},function(e,t,r){var o=r(32),n=r(0),a=r(3),i=r(6),d=r(7),s=r(8),l=r(33),p=r(34),c=r(35);e.exports=function(e,t){var r=n.ctx,a=i(e.x,e.y),g=a.x,m=a.y,u=e.angle;switch(e.type){case d['#']:l(g,m);break;case d.X:l(g,m),o(g,m);break;case d.S:l(g,m),t||s({x:g,y:m,direction:0});break;case d.E:l(g,m),c(g,m);break;case d['\u27F2']:l(g,m,u),p(g,m,u,!1);break;case d['\u27F3']:l(g,m,u),p(g,m,u,!0);break;case d['\u21A4']:case d['\u21A6']:case d['\u21A5']:case d['\u21A7']:case d['\u2194']:case d['\u2195']:console.warn('not ready yet');break;default:console.warn('unknown tile type',e,{e:d['\u27F2'],m:d['\u27F3']});}}},function(e,t,r){var o=r(0),n=r(3),a=document.getElementById('box');e.exports=function(e,t){var r=n.boardItemSize-n.boardItemMargin,i=0.05*r,d=0.9*r,s=0.5*r,l=o.ctx;l.save(),l.translate(e,t),l.rotate(3*Math.random()*Math.PI/180),l.drawImage(a,-s+i,-s+i,d,d),l.restore()}},function(e,t,r){var o=r(0),n=r(3);e.exports=function(e,t,r){var a=n.boardItemSize-n.boardItemMargin,i=0.5*a,d=o.ctx;r=r||0,d.save(),d.translate(e,t),d.rotate(r*Math.PI/180),d.fillRect(-i,-i,a,a),d.strokeRect(-i,-i,a,a),d.restore()}},function(e,t,r){var o=Math.PI,n=r(0),a=r(3);e.exports=function(e,t,i,d){var s=a.boardItemSize-a.boardItemMargin,l=0.34*s,r=0.866*l,p=0.5*l,c=0.025*s,g=0.05*s,m=0.45*s;i=i||0;var x=d?1:-1,u=n.ctx;u.save(),u.translate(e,t),u.rotate(i*o/180),u.beginPath(),u.strokeStyle='#d00',u.lineWidth=0.07*s,u.arc(0,x*-c,l,0,120*x*o/180,!d),u.stroke(),u.beginPath(),u.moveTo(0,p),u.lineTo(x*-p,r),u.lineTo(g,m),u.stroke(),u.beginPath(),u.arc(0,x*c,l,x*o,300*x*o/180,!d),u.stroke(),u.beginPath(),u.moveTo(0,-p),u.lineTo(x*p,-r),u.lineTo(-g,-m),u.stroke(),u.restore()}},function(e,t,r){var o=Math.PI,n=r(0),a=r(3);e.exports=function(e,t){var r=a.boardItemSize-a.boardItemMargin,i=0.05*r,d=0.4*r,s=0.2*r,l=n.ctx;l.save(),l.translate(e,t),l.beginPath(),l.strokeStyle='#000',l.lineWidth=i,l.arc(0,0,d,0,2*o),l.stroke(),l.beginPath(),l.strokeStyle='#D00',l.fillStyle='#D00',l.arc(0,0,2*i,0,2*o),l.stroke(),l.fill(),l.beginPath(),l.lineWidth=1,l.strokeStyle='#000',l.moveTo(0,-d),l.lineTo(0,d),l.moveTo(-d,0),l.lineTo(d,0),l.moveTo(-s,-i),l.lineTo(-s,i),l.moveTo(s,-i),l.lineTo(s,i),l.lineWidth=0.5,l.moveTo(-i,s),l.lineTo(i,s),l.moveTo(-i,-s),l.lineTo(i,-s),l.stroke(),l.restore()}},function(e,t,r){var o=r(0),n=r(3),a=r(1)('progbot:draw:draw-step'),i=r(37),d=r(38),s=n.programStepSize-n.programStepMargin;e.exports=function(e,t,r,l){a('now draw a step',e,t,r);var p=t*n.programStepSize,c=o.height-(e+1)*n.programStepSize;o.ctx.fillStyle=l?n.programStepHighlightBackground:n.programStepBackground,o.ctx.fillRect(p,c,s,s),o.ctx.strokeRect(p,c,s,s);'left'==r||'right'==r||'up'==r||'down'==r?i(p+s/2,c+s/2,r,s,l):'space'==r?d(p+s/2,c+s/2,s,l):console.warn('unknown program step',r)}},function(e,t,r){var o=Math.PI,n=r(0),a=r(3),i=r(1)('progbot:draw:arrow'),d={left:270*o/180,up:0*o/180,right:90*o/180,down:180*o/180},s=null;e.exports=function(e,t,r,o,l){var p=0.45*o,c=0.35*o,g=0.25*o,m=0.2*o,x=0.1*o,u=0.05*o,C=n.ctx;if(i('draw %s arrow',r),C.save(),C.translate(e,t),C.beginPath(),l){var h=C.createLinearGradient(0,p,0,-p);h.addColorStop(0,a.arrowHighlightGradiendStartColor),h.addColorStop(1,a.arrowHighlightGradiendEndColor),C.fillStyle=h}else s||(s=C.createLinearGradient(0,p,0,-p),s.addColorStop(0,a.arrowGradientStartColor),s.addColorStop(1,a.arrowGradientEndColor)),C.fillStyle=s;'up'==r||'down'==r?(C.rotate(d[r]),C.moveTo(0,-p),C.lineTo(p,0),C.lineTo(m,-u),C.lineTo(g,p),C.lineTo(-g,p),C.lineTo(-m,-u),C.lineTo(-p,0)):'right'==r?(C.moveTo(p,0),C.lineTo(u,-p),C.lineTo(x,-m),C.arcTo(-c,-m,-c,m,p),C.lineTo(-c,p),C.lineTo(0,p),C.arcTo(0,g,x,m,m),C.lineTo(u,p)):'left'==r?(C.moveTo(-p,0),C.lineTo(-u,-p),C.lineTo(-x,-m),C.arcTo(c,-m,c,m,p),C.lineTo(c,p),C.lineTo(0,p),C.arcTo(0,g,-x,m,m),C.lineTo(-u,p)):console.warn('invalid direction in arrow',r),C.closePath(),C.fill(),C.stroke(),C.restore()}},function(e,t,r){var o=r(0),n=r(3),a=r(1)('progbot:draw:wait'),i=null;e.exports=function(e,t,r,d){var s=0.42*r,l=s/2,p=l*1.7320508075688772,c=Math.floor(r/5),g=o.ctx;if(a('draw wait instruction'),g.save(),g.translate(e,t),g.beginPath(),d){var m=g.createLinearGradient(0,s,0,-s);m.addColorStop(0,n.waitHighlightGradiendStartColor),m.addColorStop(1,n.waitHighlightGradiendEndColor),g.fillStyle=m}else i||(i=g.createLinearGradient(0,s,0,-s),i.addColorStop(0,n.waitGradientStartColor),i.addColorStop(1,n.waitGradientEndColor)),g.fillStyle=i;g.moveTo(-l,-p),g.lineTo(l,-p),g.lineTo(s,0),g.lineTo(l,p),g.lineTo(-l,p),g.lineTo(-s,0),g.closePath(),g.fill(),g.stroke(),g.fillStyle=d?n.waitTextHighlightColor:n.waitTextColor,g.textBaseline='middle',g.textAlign='center',g.font='bold '+c+'pt Arial',g.fillText('STOP',0,0),g.restore()}},function(e,t,r){var o=r(40),n=r(42),a=r(15),i=r(54),d=r(55),s=r(56);e.exports=function(e){switch(e.preventDefault(),e.key){case'ArrowLeft':case'ArrowRight':case'ArrowUp':case'ArrowDown':d(e.key.replace('Arrow','').toLowerCase());break;case' ':s();break;case'Backspace':o();break;case'Enter':a();break;case'F':case'f':i();break;case'Escape':n();break;case'F5':location.reload();break;default:console.log('unhandled keyboard event',e);}}},function(e,t,r){var o=r(41),n=r(4),a=r(2);e.exports=function(){a()==a.IDLE?(o(),n()):console.warn('don\'t touch keyboard while animating...',a())}},function(e,t,r){var o=r(2);e.exports=function(){o.removeLastProgramStep()}},function(e,t,r){var o=r(1)('progbot:event:end-of-game'),n=r(43),a=r(15),i=r(2);e.exports=function(){var e=r(14);i()==i.RESULT_ANIMATION?(o('canceling the result screen'),a.cancelResult()):i()==i.IDLE?(o('end of the game'),i(i.END),e.done(),n()):console.warn('oh no, escape')}},function(e,t,r){var o=r(0),n=r(10);e.exports=function(){n();var e=o.ctx;e.textAlign='center',e.fillStyle='#e00',e.font='64px Arial',e.fillText('The End',o.centerX,o.centerY)}},function(e,t,r){var o=r(45),n=r(46),a=r(6),i=r(7),d=r(1)('progbot:event:on:end-of-programming:animate-program'),s=r(11),l=r(13),p=r(51),c=r(9),g=r(2),m=-1,x=null;e.exports=function e(t){var r=s(g.getBoard(),!0);r=p(r),c(r);var u=null,C=g.getProgram();if(0==C.length)return u=new Error('there is no program'),t(u,{x:0,y:0,direction:0});if(!x){d('there is no robot position, calculate it');var h=g.getBoard(),b=h.find((e)=>e.type==i.S);if(!b)return u=new Error('invalid board, no start position defined'),console.error(u),t(u,null);var w=a(b.x,b.y);x={x:w.x,y:w.y,direction:0}}m++;var S=C[m];l(C,m),n(x,S,function(r,n){n?t(null,r):o(m,r,function(r){x=r,m<C.length-1?e(t):t(null,r)})})},e.exports.reset=function(){m=-1,x=null}},function(e,t,r){var o=r(6),n=r(7),a=r(5),i=r(4),d=r(8),s=r(2);e.exports=function(e,t,r){function l(){var e=1e3*a.waitForNextStepSeconds,o=Date.now(),n=Math.min(1,(o-c)/e);p(m,u,n);var s=t;i(!0),d(s),1>n?setTimeout(l,1e3/25):(n=1,p(m,u,n),i(!0),d(s),r(s))}function p(e,r,o){for(var a,d=-1,s=0;s<g.length;s++)if(a=g[s],a.type==n['\u27F2']||a.type==n['\u27F3']){('number'!=typeof a.angle||isNaN(a.angle))&&(a.angle=0),('number'!=typeof e[s].angle||isNaN(e[s].angle))&&(e[s].angle=0);var i=a.type==n['\u27F3']?1:-1,l=90*o*i;for(d=e[s].angle+l;360<=d;)d-=360;for(;0>d;)d+=360;if(g[s].angle=d,x.x==a.x&&x.y==a.y){for(('number'!=typeof t.direction||isNaN(t.direction))&&(t.direction=0),('number'!=typeof u.direction||isNaN(u.direction))&&(u.direction=0),d=u.direction+l;360<=d;)d-=360;for(;0>d;)d+=360;t.direction=d}}}var c=Date.now(),g=s.getBoard(),m=[],x=o.reverse(t.x,t.y);g.forEach((e)=>{m.push(Object.assign({},e))});var u=Object.assign({},t);l()}},function(e,t,r){var o=r(47),n=r(48),a=r(1)('progbot:event:on:end-of-programming:animate-step'),i=r(8),d=r(49),s=r(5),l=r(50),p=r(9);e.exports=function(e,t,r){function c(){var n=1e3*s.robotStepTimeSeconds,a=Date.now(),l=Math.min(1,(a-x)/n),g=o(e,t,u?l:0.1*Math.random());p.restore(),i(g),1>l?setTimeout(c,1e3/25):u?null==m?d(g,function(){r(g,!0)}):r(g):(p.restore(),i(e),r(e))}var g=n(e,t),m=l(g),x=Date.now(),u=null==m||!0==m;a('need to move?',u),c()}},function(e,t,r){var o=r(3);e.exports=function(e,t,r){1<r&&(console.warn('percent is greater than one :(',r),r=1),0>r&&(console.warn('percent is lower than zero :(',r),r=0);var n=Object.assign({},e);switch(t){case'up':switch(e.direction){case 0:n.y-=o.boardItemSize*r;break;case 90:n.x+=o.boardItemSize*r;break;case 180:n.y+=o.boardItemSize*r;break;case 270:n.x-=o.boardItemSize*r;break;default:console.error('wrong direction detected',e);}break;case'down':switch(e.direction){case 0:n.y+=o.boardItemSize*r;break;case 90:n.x-=o.boardItemSize*r;break;case 180:n.y-=o.boardItemSize*r;break;case 270:n.x+=o.boardItemSize*r;break;default:console.error('wrong direction detected',e);}break;case'left':n.direction-=90*r;break;case'right':n.direction+=90*r;break;case'space':break;default:console.warn('unknown program instruction detected',t);}for(;360<=n.direction;)n.direction-=360;for(;0>n.direction;)n.direction+=360;return n}},function(e,t,r){var o=r(6),n=r(2);e.exports=function(e,t){var r=n.getBoard(),a=o.reverse(e.x,e.y),i=Object.assign({},a),s=0;if('up'==t?s=1:'down'==t&&(s=-1),s)switch(e.direction){case 0:i.y-=s;break;case 90:i.x+=s;break;case 180:i.y+=s;break;case 270:i.x-=s;}var d=r.find((e)=>e.x==i.x&&e.y==i.y);return d}},function(e,t,r){var o=r(1)('progbot:event:on:end-of-programming:fall-down'),n=r(8),a=r(5),i=r(9),d=1e3*a.robotStepTimeSeconds;e.exports=function(e,t){function r(){for(var a=Date.now(),s=Math.min(1,(a-o)/d),l=360*(Math.pow(s,3)*5)+e.direction;360<l;)l-=360;for(;0>l;)l+=360;var p=Object.assign({},e);p.direction=l,i.restore(),n(p,1-s),1>s?setTimeout(r,1e3/25):t()}var o=Date.now();r()}},function(e){e.exports=function(e){var t=null;return e&&(t=!(1&e.type)),t}},function(e,t,r){var o=Math.min,n=Math.max,a=r(0),i=r(3),d=r(1)('progbot:draw:util:extend-board');e.exports=function(e){var t=Object.assign({},e);return t.x=n(0,t.x-i.boardItemSize),t.y=n(0,t.y-i.boardItemSize),t.w=o(a.width,t.w+2*i.boardItemSize),t.h=o(a.height,t.h+2*i.boardItemSize),d('extend board from %o to %o',e,t),t}},function(e,t,r){var o=r(6),n=r(7),a=r(2);e.exports=function(e){var t=!1;if(e){var r=o.reverse(e.x,e.y),i=a.getBoard(),d=i.find((e)=>e.type==n.E);d?t=d.x==r.x&&d.y==r.y:(console.error('there is no target tile in board'),t=!1)}return t}},function(e,t,r){var o=r(0),n=document.getElementById('smiley'),a=document.getElementById('sad');e.exports=function(e){var t=o.ctx,r=Math.min(o.centerX,o.centerY),i=0.05*r,d=0.9*r,s=0.5*r;t.save(),t.translate(o.centerX,o.centerY),t.rotate((45*Math.random()-22.5)*Math.PI/180),t.drawImage(e?n:a,-s+i,-s+i,d,d),t.restore()}},function(e,t,r){var o=r(16);e.exports=o},function(e,t,r){var o=r(17),n=r(4),a=r(2);e.exports=function(e){a()==a.IDLE?(o(e),n()):console.warn('don\'t touch keyboard while animating!',a())}},function(e,t,r){var o=r(17),n=r(4),a=r(2);e.exports=function(){a()==a.IDLE?(o('space'),n()):console.warn('don\'t touch keyboard while animating!',a())}},function(e){e.exports=function(){}}]);
//# sourceMappingURL=http://localhost:81/progbot/dist/progbot.js.map